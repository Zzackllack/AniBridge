# This docker-compose file is intended for development and testing purposes only.
# It sets up the AniBridge application along with Sonarr, Radarr, Prowlarr, and Jellyfin services.
# Adjust environment variables and volume mounts as needed for your development setup.

version: "3.8"
services:
  anibridge:
    build: .
    container_name: anibridge-dev
    ports:
      - "8000:8000"
    env_file:
      - .env
    volumes:
      - ./data:/app/data
    healthcheck:
      test:
        ["CMD", "curl", "--fail", "--silent", "http://localhost:8000/health"]
      interval: 30s
      timeout: 5s
      retries: 3

  sonarr:
    image: linuxserver/sonarr:latest
    container_name: sonarr-dev
    ports:
      - "8989:8989"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./data/sonarr/config:/config
      - ./data/downloads:/downloads
      - ./data/sonarr/tv:/tv
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr-dev
    ports:
      - "9696:9696"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./data/prowlarr/config:/config
    restart: unless-stopped

  radarr:
    image: linuxserver/radarr:latest
    container_name: radarr-dev
    ports:
      - "7878:7878"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Berlin
    volumes:
      - ./data/radarr/config:/config
      - ./data/downloads:/downloads
      - ./data/radarr/movies:/movies
    restart: unless-stopped

  jellyfin:
    image: jellyfin/jellyfin
    container_name: jellyfin
    ports:
      - 8096:8096/tcp
      - 7359:7359/udp
    volumes:
      - ./data/jellyfin/config:/config
      - ./data/jellyfin/cache:/cache
      - type: bind
        source: ./data/sonarr/tv
        target: /tv
      - type: bind
        source: ./data/radarr/movies
        target: /movies
    restart: "unless-stopped"
    # Optional - alternative address used for autodiscovery
    environment:
      - JELLYFIN_PublishedServerUrl=http://example.com
    # Optional - may be necessary for docker healthcheck to pass if running in host network mode
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  default:
    name: anibridge-dev-net
