version: "3.8"
services:
  anibridge:
    image: ghcr.io/zzackllack/anibridge:latest
    container_name: anibridge
    ports:
      - "8000:8000"
    environment:
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - CHOWN_RECURSIVE=${CHOWN_RECURSIVE:-true}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DOWNLOAD_DIR=${DOWNLOAD_DIR:-/data/downloads/anime}
      - DATA_DIR=${DATA_DIR:-/data}
      - QBIT_PUBLIC_SAVE_PATH=${QBIT_PUBLIC_SAVE_PATH}
      - ANIWORLD_ALPHABET_HTML=${ANIWORLD_ALPHABET_HTML}
      - ANIWORLD_ALPHABET_URL=${ANIWORLD_ALPHABET_URL:-https://aniworld.to/animes-alphabet}
      - ANIWORLD_TITLES_REFRESH_HOURS=${ANIWORLD_TITLES_REFRESH_HOURS:-24}
      - SOURCE_TAG=${SOURCE_TAG:-WEB}
      - RELEASE_GROUP=${RELEASE_GROUP:-aniworld}
      - PROVIDER_ORDER=${PROVIDER_ORDER:-VOE,Filemoon,Streamtape,Vidmoly,SpeedFiles,Doodstream,LoadX,Luluvdo,Vidoza}
      - MAX_CONCURRENCY=${MAX_CONCURRENCY:-3}
      - INDEXER_NAME=${INDEXER_NAME:-AniBridge Torznab}
      - INDEXER_API_KEY=${INDEXER_API_KEY}
      - TORZNAB_CAT_ANIME=${TORZNAB_CAT_ANIME:-5070}
      - AVAILABILITY_TTL_HOURS=${AVAILABILITY_TTL_HOURS:-24}
      - TORZNAB_FAKE_SEEDERS=${TORZNAB_FAKE_SEEDERS:-999}
      - TORZNAB_FAKE_LEECHERS=${TORZNAB_FAKE_LEECHERS:-787}
      - TORZNAB_RETURN_TEST_RESULT=${TORZNAB_RETURN_TEST_RESULT:-true}
      - TORZNAB_TEST_TITLE=${TORZNAB_TEST_TITLE:-AniBridge Connectivity Test}
      - TORZNAB_TEST_SLUG=${TORZNAB_TEST_SLUG:-connectivity-test}
      - TORZNAB_TEST_SEASON=${TORZNAB_TEST_SEASON:-1}
      - TORZNAB_TEST_EPISODE=${TORZNAB_TEST_EPISODE:-1}
      - TORZNAB_TEST_LANGUAGE=${TORZNAB_TEST_LANGUAGE:-German Dub}
      # STRM files
      - STRM_FILES_MODE=${STRM_FILES_MODE:-no}
      # Cleanup
      - DELETE_FILES_ON_TORRENT_DELETE=${DELETE_FILES_ON_TORRENT_DELETE:-true}
      - DOWNLOADS_TTL_HOURS=${DOWNLOADS_TTL_HOURS:-0}
      - CLEANUP_SCAN_INTERVAL_MIN=${CLEANUP_SCAN_INTERVAL_MIN:-30}
      # Progress rendering
      - PROGRESS_FORCE_BAR=${PROGRESS_FORCE_BAR:-false}
      - PROGRESS_STEP_PERCENT=${PROGRESS_STEP_PERCENT:-5}
      # Update notifier / GitHub
      - ANIBRIDGE_UPDATE_CHECK=${ANIBRIDGE_UPDATE_CHECK:-true}
      - ANIBRIDGE_GITHUB_TOKEN=${ANIBRIDGE_GITHUB_TOKEN}
      - ANIBRIDGE_GITHUB_OWNER=${ANIBRIDGE_GITHUB_OWNER:-zzackllack}
      - ANIBRIDGE_GITHUB_REPO=${ANIBRIDGE_GITHUB_REPO:-AniBridge}
      - ANIBRIDGE_GHCR_IMAGE=${ANIBRIDGE_GHCR_IMAGE:-zzackllack/anibridge}
      - ANIBRIDGE_RELOAD=${ANIBRIDGE_RELOAD:-false}
      # Networking / Proxy
      - PROXY_ENABLED=${PROXY_ENABLED:-false}
      - PROXY_URL=${PROXY_URL}
      - PROXY_HOST=${PROXY_HOST}
      - PROXY_PORT=${PROXY_PORT}
      - PROXY_SCHEME=${PROXY_SCHEME:-socks5}
      - PROXY_USERNAME=${PROXY_USERNAME}
      - PROXY_PASSWORD=${PROXY_PASSWORD}
      - HTTP_PROXY_URL=${HTTP_PROXY_URL}
      - HTTPS_PROXY_URL=${HTTPS_PROXY_URL}
      - ALL_PROXY_URL=${ALL_PROXY_URL}
      - NO_PROXY=${NO_PROXY}
      - PROXY_FORCE_REMOTE_DNS=${PROXY_FORCE_REMOTE_DNS:-false}
      - PROXY_DISABLE_CERT_VERIFY=${PROXY_DISABLE_CERT_VERIFY:-false}
      - PROXY_APPLY_ENV=${PROXY_APPLY_ENV:-true}
      - PROXY_IP_CHECK_INTERVAL_MIN=${PROXY_IP_CHECK_INTERVAL_MIN:-30}
      - PYTHONUNBUFFERED=1
    volumes:
      - ./data:/data
    healthcheck:
      test:
        ["CMD", "curl", "--fail", "--silent", "http://localhost:8000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
