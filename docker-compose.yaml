version: "3.8"
services:
  anibridge:
    image: ghcr.io/zzackllack/anibridge:latest
    container_name: anibridge
    ports:
      - "8000:8000"
    environment:
      # Container runtime / permissions
      - PUID=${PUID:-1000}
      - PGID=${PGID:-1000}
      - CHOWN_RECURSIVE=${CHOWN_RECURSIVE:-true}
      # Core paths (keep aligned with volume mounts)
      - DATA_DIR=${DATA_DIR:-/data}
      - DOWNLOAD_DIR=${DOWNLOAD_DIR:-/data/downloads}
      # Common user-facing settings
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - QBIT_PUBLIC_SAVE_PATH=${QBIT_PUBLIC_SAVE_PATH}
      - MAX_CONCURRENCY=${MAX_CONCURRENCY:-3}
      - DOWNLOAD_RATE_LIMIT_BYTES_PER_SEC=${DOWNLOAD_RATE_LIMIT_BYTES_PER_SEC:-0}
      - INDEXER_API_KEY=${INDEXER_API_KEY}
      - STRM_FILES_MODE=${STRM_FILES_MODE:-no}
      # Optional operational toggles
      - ANIBRIDGE_UPDATE_CHECK=${ANIBRIDGE_UPDATE_CHECK:-true}
      - ANIBRIDGE_HOST=${ANIBRIDGE_HOST:-0.0.0.0}
      - ANIBRIDGE_PORT=${ANIBRIDGE_PORT:-8000}
      - DB_MIGRATE_ON_STARTUP=${DB_MIGRATE_ON_STARTUP:-true}
      - PYTHONUNBUFFERED=1
    volumes:
      - ./data:/data
    healthcheck:
      test:
        ["CMD", "curl", "--fail", "--silent", "http://localhost:8000/health"]
      interval: 30s
      timeout: 5s
      retries: 3
